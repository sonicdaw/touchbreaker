10 '
20 '     T O U C H  B R E A K E R
30 '
40 '                                                                BY M.SUMIYOSHI
50 '
60 SCREEN 1,1,0:COLOR 15,1,1:WIDTH 32:KEY OFF:DEFINT A-Z:DEFUSR=&H90
70 DIM D$(12),DX(12),DY(12),KV(11,12):JS=0:R=1
80 '
90 '     D A T A  S E T
100 '
110 G$=CHR$(29)+CHR$(29)+CHR$(31):BR$="ああ"+G$+"ああ":HI$="ｱｱ"+G$+"ｱｱ":BL$="ﾀﾀ"+G$+"ﾀﾀ":BA$="ｸｸ"+G$+"ｸｸ":B3$="○○"+G$+"○○":B2$=".."+G$+"..":FOR J=0 TO 1
120 C$="":FOR I=0 TO 7:READ D$:C$=C$+CHR$(VAL("&H"+D$)):NEXT:SPRITE$(J)=C$:NEXT
130 FOR J=0 TO 4:READ AD:FOR I=0 TO 7:READ D$:VPOKE AD+I,VAL("&H"+D$):NEXT:NEXT
140 FOR I=1 TO 12:READ D$(I),DX(I),DY(I):NEXT
150 '
160 '     D E M O
170 '
180 LOCATE 10,10:PRINT "TOUCH BREAKER":SOUND 7,&HB8:SOUND 8,15:SOUND 9,12
190 FOR C=0 TO 15:COLOR C:SOUND 0,INT(RND(1)*256):SOUND 1,0:SOUND 2,INT(RND(1)*256):SOUND 3,3:IF STRIG(JS)=0 THEN NEXT: GOTO 190 ELSE C=15:NEXT
200 COLOR 15:FOR I=0 TO 5:READ AD,W$:VPOKE AD,VAL("&H"+W$):NEXT
210 CLS:PLAY "T200L8S4M40000O7C1":LOCATE 9,24:PRINT "SELECT STEP NO"
220 FOR I=0 TO 13:PRINT:NEXT
230 FOR I=0 TO 1:T=STICK(JS):R=R-(T=1)+(T=5):R=R-(R=0)*12+(R=13)*12
240 FOR J=0 TO 100:NEXT:LOCATE 15,11:PRINT USING "##";R:I=-STRIG(JS):NEXT
250 '
260 '     D I S P L A Y
270 '
280 CLS:PRINT STRING$(22,177):FOR I=1 TO 22:LOCATE 0,I:PRINT "ｱ"
290 LOCATE 21,I:PRINT "ｱ":NEXT:PRINT STRING$(22,177);
300 FOR I=1 TO 22:LOCATE 1,I:PRINT STRING$(20,132):NEXT
310 '
320 FOR I=1 TO 10:FOR J=1 TO 11:KV(I,J)=0:NEXT:NEXT
330 FOR J=0 TO 12 STEP 12:FOR I=0 TO 11:KV(I,J)=-1:NEXT:NEXT
340 FOR I=1 TO 11:KV(0,I)=-1:KV(11,I)=-1:NEXT
350 LS=1:S=0:FOR TX=1 TO 20 STEP 2:FOR TY=0 TO 2:Z$=RIGHT$("000"+BIN$(VAL("&H"+MID$(D$(R),LS,1))),4):FOR I=0 TO 3:IF MID$(Z$,I+1,1)="1" THEN LOCATE TX,TY*8+I*2+1:PRINT BR$:S=S+1:KV((TX-1)/2+1,(TY*8+I*2)/2+1)=1:GOSUB 910
360 NEXT:LS=LS+1:NEXT:NEXT
370 LOCATE 23,10:PRINT "STEP ";R:X=DX(R):Y=DY(R):SOUND 4,0:SOUND 5,0
380 FOR I=-1 TO 1:FOR J=-1 TO 1:IF KV(X+I,Y+J)=1 THEN RX=X+I:RY=Y+J:GOSUB 660
390 NEXT:NEXT:CW=0
400 '
410 '     M A I N
420 '
430 IF S=0 THEN 830
440 PUT SPRITE 0,((X-1)*16+8,(Y-1)*16+8),10,CW:H=STICK(JS):IF H<>0 THEN VX=(H=7)-(H=3):VY=(H=1)-(H=5):IF VX+VY=0 THEN 440 ELSE 500
450 IF STRIG(JS) THEN LOCATE 7,10:PRINT "GIVE UP!":A=USR(0):PLAY "T200L8S0M1000O6CGFDC4E4C2R2":FOR I=-1 TO 0:I=PLAY(0):NEXT:GOSUB 480: GOTO 280
460 I$=INKEY$:IF I$="R" OR I$="r" THEN GOSUB 480:GOTO 210
470 GOTO 440
480 PUT SPRITE 0,(0,208):CLS:RETURN
490 '
500 D=KV(X+VX,Y+VY):ON D+2 GOTO 440,510,680
510 GOSUB 520:IF FT=0 THEN 440 ELSE 570
520 FT=0:IF VY=0 THEN W1=X:W2=X+VX:W3=VX:E1=Y-1:E2=Y+1:E3=2:GOTO 540
530 W1=X-1:W2=X+1:W3=2:E1=Y:E2=Y+VY:E3=VY
540 FOR CX=W1 TO W2 STEP W3:FOR CY=E1 TO E2 STEP E3:IF KV(CX,CY)<>0 THEN FT=1
550 NEXT:NEXT:RETURN
560 '
570 PX=(X-1)*16+8:PY=(Y-1)*16+8:CW=CW XOR 1
580 FOR I=0 TO 16:PUT SPRITE 0,(PX+I*VX,PY+I*VY),10,CW:NEXT
590 IF VY=0 THEN E1=-VX:FOR E2=-1 TO 1 ELSE E2=-VY:FOR E1=-1 TO 1
600 IF KV(X+E1,Y+E2)=1 THEN BX=X+E1:BY=Y+E2:GOSUB 750
610 NEXT:X=X+VX:Y=Y+VY
620 '
630 IF VX=0 THEN E2=VY:FOR E1=-1 TO 1 ELSE E1=VX:FOR E2=-1 TO 1
640 IF KV(X+E1,Y+E2)=1 THEN RX=X+E1:RY=Y+E2:GOSUB 660
650 NEXT:GOTO 430
660 LOCATE (RX-1)*2+1,(RY-1)*2+1:PRINT BL$:RETURN
670 '
680 GOSUB 520:IF FT=0 THEN 440
690 IF KV(X+VX*2,Y+VY*2)<>0 THEN 440
700 GOSUB 920:RX=(X+VX-1)*2+1:RY=(Y+VY-1)*2+1:FOR I=0 TO 1:LOCATE RX,RY:PRINT B3$:LOCATE RX+VX,RY+VY:PRINT BL$:RX=RX+VX:RY=RY+VY:NEXT
710 KV(X+VX,Y+VY)=0:KV(X+VX*2,Y+VY*2)=1:GOTO 570
720 '
730 '     B L O C K  E R A S E
740 '
750 BX=(BX-1)*2+1:BY=(BY-1)*2+1
760 GOSUB 930:LOCATE BX,BY:PRINT BA$:GOSUB 790
770 LOCATE BX,BY:PRINT B2$:GOSUB 790:LOCATE BX,BY:PRINT B3$:GOSUB 790
780 S=S-1:KV((BX+1)/2,(BY+1)/2)=0:SOUND 7,&HB8:RETURN
790 FOR MI=0 TO 300:NEXT:RETURN
800 '
810 '     C L E A R
820 '
830 LOCATE 3,10:PRINT "STEP: ";R;" CLEAR !"
840 A=USR(0):PLAY "T200S0M2000L8O6ABBABR2V15"
850 A$="T200O4AABAGFEFBAGFE2":A2$="V13L8R8"+A$:A$=A$+"E8":PLAY A$,A2$
860 IF PLAY(0) THEN 860 ELSE FOR I=0 TO 2000:NEXT: PUT SPRITE 0,(0,209)
870 GOTO 210
880 '
890 '     S O U N D
900 '
910 SOUND 7,&HB8:SOUND 2,50:SOUND 3,0:FOR K=15 TO 7 STEP -1:SOUND 9,K:FOR H=0 TO 20:NEXT:NEXT:SOUND 9,0:RETURN
920 SOUND 7,&HB8:SOUND 2,250:SOUND 3,4:FOR I=15 TO 6 STEP -1:SOUND 9,I:SOUND 2,I*10:FOR J=0 TO I*3:NEXT:NEXT:SOUND 9,0:RETURN
930 SOUND 2,150:SOUND 3,15:SOUND 7,&HAA:SOUND 9,16:SOUND 11,255:SOUND 12,15:SOUND 13,0:SOUND 6,95:RETURN
940 '
950 '     G R A P H I C D A T A
960 '
970 DATA 3C,7E,5A,DB,FF,7E,E4,07         ,3C,7E,5A,DB,FF,7E,27,E0
980 DATA 1416,00,7E,7E,7E,7E,7E,7E,00 ,1472,77,EE,77,EE,77,EE,77,EE
990 DATA 1056,F1,FB,FB,00,8F,DF,DF,00, 1160,FB,FB,FB,00,DF,DF,DF,00
1000 DATA 1536,FB,FB,FB,00,DF,DF,DF,00
1010 '
1020 '     S T E P  D A T A
1030 '
1040 '        123456789ABCDEF123456789ABCDEF
1050 DATA 0002A80A00A00A00A00A00A02A8000,1,11
1060 DATA 048040000000444444000000040240,10,11
1070 DATA 0000000A03B80000003B80A0000000,5,6
1080 DATA 00008010088000008001E00240A000,3,5
1090 DATA 0000002081F01101101F0208000000,6,7
1100 DATA 000000010108010000100200110000,10,11
1110 DATA F1C80C00C1C00060061C000C80CF1C,5,1
1120 DATA 8044080000000400C0020000414800,1,9
1130 DATA 100094202000900010110400000004,5,11
1140 DATA 134220420880200000080108000000,1,11
1150 DATA 022400800824020000000102000000,6,1
1160 DATA 000000084008300300008084000000,10,11
1170 '
1180 DATA 8208,50,8210,6F,8214,FE,8215,E5,8197,E5,8216,EF